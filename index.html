<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LEGI√ìN SCARFACE | OPERACIONES</title>
    
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>

    <style>
        :root {
            --neon-green: #00ff41;
            --blood-red: #ff0000;
            --dark-bg: #050505;
            --terminal-font: 'Courier New', Courier, monospace;
        }

        /* --- RESET Y ESTRUCTURA BASE --- */
        * { box-sizing: border-box; }
        body, html {
            background-color: var(--dark-bg);
            color: var(--neon-green);
            font-family: var(--terminal-font);
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- PANTALLA DE CARGA (MOBILE FRIENDLY) --- */
        #splash-screen {
            position: fixed;
            inset: 0;
            background: black;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }

        #splash-image {
            max-width: 70%;
            max-height: 50%;
            border: 2px solid var(--blood-red);
            box-shadow: 0 0 15px var(--blood-red);
            object-fit: contain;
        }

        .loading-text {
            margin-top: 25px;
            font-size: 0.9rem;
            letter-spacing: 3px;
            text-align: center;
            animation: blink 0.8s infinite;
        }

        /* --- LAYOUT PRINCIPAL --- */
        #main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 1.5s ease;
            position: relative;
        }

        /* Efecto de l√≠neas de TV vieja */
        #scanlines {
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
            z-index: 5;
        }

        /* Cabecera optimizada */
        header {
            padding: 10px;
            border-bottom: 1px solid var(--blood-red);
            background: rgba(0,0,0,0.8);
        }

        .cia-header {
            border: 1px solid #fff;
            color: #fff;
            font-size: 0.7rem;
            text-align: center;
            padding: 5px;
            margin-bottom: 5px;
        }

        .phrase {
            font-size: 0.65rem;
            color: var(--blood-red);
            text-align: center;
            margin: 5px 0;
            text-transform: uppercase;
        }

        /* --- √ÅREA DE TERMINAL (SCROLL) --- */
        .terminal {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-size: 13px;
            scroll-behavior: smooth;
        }

        .msg-line { margin-bottom: 8px; border-left: 2px solid #222; padding-left: 8px; }
        .timestamp { color: #555; font-size: 0.7rem; margin-right: 5px; }
        .user-tag { color: #fff; font-weight: bold; }
        
        /* --- BARRA DE ENTRADA (M√ìVIL ADAPTADO) --- */
        .input-area {
            background: #000;
            padding: 12px;
            display: flex;
            align-items: center;
            border-top: 1px solid #333;
            gap: 10px;
        }

        .prompt { color: var(--neon-green); font-size: 0.8rem; white-space: nowrap; }

        #command-line {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--neon-green);
            outline: none;
            font-family: inherit;
            font-size: 16px; /* Evita zoom autom√°tico en iPhone */
        }

        .clip-btn {
            color: var(--blood-red);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 5px;
        }

        /* --- ANIMACIONES --- */
        @keyframes blink { 50% { opacity: 0; } }

        /* Ajustes para PC */
        @media (min-width: 768px) {
            .cia-header { font-size: 1rem; padding: 10px; }
            .phrase { font-size: 0.85rem; }
            .terminal { font-size: 15px; padding: 30px; }
            .prompt { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="NOMBRE_DE_TU_IMAGEN.jpg" id="splash-image" alt="SCARFACE">
        <div class="loading-text">ESTABLECIENDO CONEXI√ìN P2P...</div>
    </div>

    <div id="main-content">
        <div id="scanlines"></div>
        
        <header>
            <div class="cia-header">SISTEMA OPERATIVO SCARFACE V7.0 - ACCESO RESTRINGIDO</div>
            <div class="phrase">"Nuestra palabra es el acero que forja la libertad"</div>
        </header>

        <div class="terminal" id="terminal">
            <p style="color:#888;">> N√∫cleo cargado. Red Gun.js vinculada.</p>
            <p style="color:#888;">> Use <b>/register</b> para descargar su llave.</p>
            <hr style="border:0; border-top:1px solid #222; margin:10px 0;">
        </div>

        <div class="input-area">
            <span class="prompt">ID@LEGION:~$</span>
            <input type="text" id="command-line" autocomplete="off" autofocus>
            <label for="file-upload" class="clip-btn" title="Adjuntar Archivo">üìé</label>
            <input type="file" id="file-upload" style="display:none;" onchange="handleFile(this)">
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN RED P2P ---
        const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
        const db = gun.get('legion-scarface-secure-v7');

        const terminal = document.getElementById('terminal');
        const input = document.getElementById('command-line');

        // --- RECEPCI√ìN DE MENSAJES ---
        db.map().once((data, id) => {
            if (data && data.msg) {
                const time = new Date(data.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const isImg = data.msg.includes('data:image');
                
                const div = document.createElement('div');
                div.className = 'msg-line';
                div.innerHTML = `<span class="timestamp">[${time}]</span> ` + 
                                (isImg ? `<br>${data.msg}` : `<span class="user-tag">></span> ${data.msg}`);
                
                terminal.appendChild(div);
                terminal.scrollTop = terminal.scrollHeight;
            }
        });

        // --- ENV√çO DE MENSAJES ---
        input.addEventListener('keydown', async (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim();
                if (!val) return;

                if (val.toLowerCase() === '/register') {
                    await generarLlave();
                } else {
                    db.set({ msg: val, time: Date.now() });
                }
                input.value = '';
            }
        });

        // --- PROCESAR ARCHIVOS ---
        function handleFile(el) {
            const file = el.files[0];
            if (file.size > 1024 * 1024) return alert("M√°ximo 1MB para red P2P");
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const imgTag = `<img src="${e.target.result}" style="max-width:250px; border:1px solid red; margin:10px 0; display:block;">`;
                db.set({ msg: imgTag, time: Date.now() });
            };
            reader.readAsDataURL(file);
        }

        // --- GENERAR LLAVE RSA ---
        async function generarLlave() {
            const pair = await window.crypto.subtle.generateKey(
                { name: "RSA-OAEP", modulusLength: 2048, publicExponent: new Uint8Array([1,0,1]), hash: "SHA-256" },
                true, ["encrypt", "decrypt"]
            );
            const exp = await window.crypto.subtle.exportKey("pkcs8", pair.privateKey);
            const blob = new Blob([exp], {type: "application/octet-stream"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = "LEGION_ACCESS.skf"; a.click();
            imprimirSistema("LLAVE GENERADA EXITOSAMENTE.");
        }

        function imprimirSistema(t) {
            terminal.innerHTML += `<p style="color:yellow;">> SISTEMA: ${t}</p>`;
            terminal.scrollTop = terminal.scrollHeight;
        }

        // --- CONTROL DE PANTALLA ---
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('splash-screen').style.opacity = '0';
                document.getElementById('main-content').style.opacity = '1';
                setTimeout(() => document.getElementById('splash-screen').style.display='none', 1000);
            }, 3000);
        };
    </script>
</body>
</html>
